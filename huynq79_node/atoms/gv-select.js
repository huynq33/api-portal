import{classMap as e}from"lit-html/directives/class-map";import{ifDefined as t}from"lit-html/directives/if-defined";import{LitElement as i,html as l,css as s}from"lit-element";import{skeleton as a}from"../styles/skeleton";import{link as o}from"../styles/link";import{input as r}from"../styles/input";import{repeat as n}from"lit-html/directives/repeat";import"./gv-icon";import{dispatchCustomEvent as c}from"../lib/events";import{InputElement as d}from"../mixins/input-element";import{withResizeObserver as h}from"../mixins/with-resize-observer";export class GvSelect extends(h(d(i))){static get properties(){return{...super.properties,options:{type:Array},_options:{type:Array,attribute:!1},large:{type:Boolean},medium:{type:Boolean},small:{type:Boolean},value:{type:String|Array},_value:{type:String|Array,attribute:!1},label:{type:String},title:{type:String},name:{type:String},placeholder:{type:String},description:{type:String},multiple:{type:Boolean,reflect:!0},_isClosed:{type:Boolean,attribute:!1}}}static get styles(){return[...super.styles,a,r,o,s`.box{--bdc:var(--gv-select--bdc, var(--gv-theme-neutral-color-dark, #d9d9d9));--c:var(--gv-select--c, var(--gv-theme-font-color-dark, #262626));--bgc:var(--gv-select--bgc, var(--gv-theme-neutral-color-lightest, #ffffff));--bgc-list:var(--gv-select--list-bgc, var(--gv-select--bgc, var(--gv-theme-neutral-color-lightest, #ffffff)));--hover-bgc:var(--gv-select-hover--bgc, var(--gv-theme-color-light, #86c3d0));--selected-bgc:var(--gv-select-selected--bgc, var(--gv-theme-neutral-color-light, #efefef));position:relative}div,input{user-select:none;color:var(--c);cursor:pointer}input{background-color:var(--bgc);border-color:var(--bdc);text-overflow:ellipsis;white-space:nowrap;overflow:hidden}:host([readonly]) div,:host([readonly]) input,:host([readonly]) input:read-only:hover{user-select:auto;cursor:text}input:read-only:hover{cursor:pointer}.box-icon gv-icon{--gv-icon--c:var(--c)}gv-icon{transform:rotate(180deg);--gv-icon--s:19px}.medium gv-icon{--gv-icon--s:14px}.small gv-icon{--gv-icon--s:11px}.closed .select__list{display:none;opacity:0;transform:translateY(-2em);z-index:-1}.select__list{color:var(--c);list-style:none;position:absolute;background-color:var(--bgc-list);list-style:none;padding:0;transition:all .3s ease 0s;margin:0;width:100%;cursor:pointer;z-index:110;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12);max-height:340px;overflow:auto}.select__list .selected{background-color:var(--selected-bgc)}.select__list__item{border-left:1px solid var(--bdc);display:flex;align-items:center;transition:all .5s ease;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.select__list__item.disabled{opacity:.5}.select__list__item.disabled:hover{cursor:not-allowed}.large .select__list__item{padding:var(--input-large--p);font-size:var(--input-large--fz);height:var(--input-large--h)}.medium .select__list__item{padding:0 5px;font-size:var(--input-medium--fz);height:var(--input-medium--h)}.small .select__list__item{padding:var(--input-small--p);font-size:var(--input-small--fz);height:var(--input-small--h)}.select__list__item:hover{background-color:var(--hover-bgc);border-left:1px dotted var(--bdc)}.large.icon input,.medium.icon input,.small.icon input{padding-right:25px}`]}constructor(){super(),this._type="text",this._isClosed=!0,this._options=[{label:"",value:"",disabled:!1,title:null}],this._handleDocumentClick=this._onDocumentClick.bind(this)}connectedCallback(){super.connectedCallback(),window.addEventListener("click",this._handleDocumentClick)}disconnectedCallback(){window.removeEventListener("click",this._handleDocumentClick),super.disconnectedCallback()}set value(e){this.multiple?(null==e&&(this._value=null,this.updateState(this._value)),Array.isArray(e)&&(this._value=e,this.updateState(this._value))):(this._value=e,this.updateState(this._value))}get value(){return this._value}updateState(e){if(super.updateState(e),e&&this._options&&this.valid){if(this.multiple){if(this.required&&this.setValidity(0===e.length,"field is required"),e.length>0&&this.valid){const t=this._options.map(e=>e.value);this.setValidity(!e.some(e=>t.includes(e)),"value is not included in the possible values")}}else this.setValidity(this.required&&null==this._options.find(t=>t.value===e),"value is not included in the possible values");this.invalid=!this.valid}}close(){this._isClosed=!0}_onDocumentClick(){this._isClosed=!0}_onClick(e){this.disabled||this.skeleton||(e.preventDefault(),e.stopPropagation(),this._isClosed&&this.dispatchEvent(new Event("click",{bubbles:!0,cancelable:!0,composed:!0})),this._isClosed=!this._isClosed)}_onSelect(e,t){if(t.stopPropagation(),!0!==e.disabled){if(this.multiple)if(this.value||(this.value=[]),this.value.includes(t.target.dataset.value)){const e=this.value.indexOf(t.target.dataset.value);e>-1&&("string"==typeof this.value?this.value=[]:(this.value.splice(e,1),this.value=[...this.value]))}else this.value=[...this.value,t.target.dataset.value];else this.value=t.target.dataset.value,this._isClosed=!this._isClosed;c(this,"select",this.value),c(this,"input",this.value),this.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}}_onClear(){this.value=[],c(this,"select",this.value),c(this,"input",this.value),this.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}_renderIcon(){return this.readonly?"":this.multiple&&null!=this.value&&this.value.length>0?l`<div class="box-icon"> <gv-icon class="link" shape="code:error" @click="${this._onClear}"></gv-icon> </div>`:l`<div class="box-icon"> <gv-icon class="link" shape="design:triangle" @click="${this._onClick}"></gv-icon> </div>`}set options(e){e&&(this._options=e.map(e=>"object"!=typeof e?{value:e,label:e}:e.label?e:{value:e.value,label:e.value}))}selectedLabel(){if(null!=this.value){const e=this._options.filter(e=>this.isSelected(e));if(e)return e.map(e=>e.label).join(", ")}return""}onResize(){const e=this.shadowRoot.querySelector("input"),{width:t}=window.getComputedStyle(e),i=this.shadowRoot.querySelector(".select__list");null!=i&&(i.style.width=t)}render(){const i={box:!0,closed:this._isClosed,large:this.large,medium:this.medium||!this.large&&!this.small,small:this.small,icon:!0,skeleton:this.skeleton,required:this.required},s=this.selectedLabel();return l` <div class="${e(i)}"> <div class="box-input"> ${this.renderLabel()} <input id="${this._id}" .type="${this._type}" .name="${t(this.name)}" .title="${t(s||this.title||this.label)}" .required="${this.required}" aria-required="${!!this.required}" ?disabled="${this.disabled||this.skeleton}" .placeholder="${t(this.placeholder)}" .value="${s}" @click="${this._onClick}" readonly="readonly"> ${this._renderIcon()} </div> ${this.readonly?"":l` <ul class="${e(Object.assign({select__list:!0}))}"> ${this._options&&n(this._options,e=>e,i=>l` <li class="${e({select__list__item:!0,selected:this.isSelected(i),disabled:i.disabled})}" @click="${this._onSelect.bind(this,i)}" data-value="${i.value}" .title="${t(i.title)}"> ${i.label} </li> `)} </ul>`} </div> ${null!=this.description?l`<div class="description" .innerHTML="${this.description}"></div>`:""} `}isSelected(e){return this.multiple?this.value&&this.value.includes(e.value):""+this.value==""+e.value}}window.customElements.define("gv-select",GvSelect);
//# sourceMappingURL=gv-select.js.map
